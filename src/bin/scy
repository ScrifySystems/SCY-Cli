#!/usr/bin/env php
<?php
declare(strict_types=1);

require __DIR__ . '/../../vendor/autoload.php';

use Scy\Commands\CountCommand;

$version = '1.0.0';

// strip script name
$args = $_SERVER['argv'] ?? [];
array_shift($args);

// default to `count` if user passed only a path
if ($args && $args[0] !== 'count' && $args[0] !== 'help' && $args[0] !== 'version') {
    array_unshift($args, 'count');
}

$command = $args[0] ?? 'help';

$commands = [
    'count'   => new CountCommand(),
    'help'    => function () {
        echo <<<TXT
Usage:
  scy count [path] [--exclude-dir=a,b] [--exclude-file=x,y] [--json]

Examples:
  scy count .
  scy count /var/www/project --exclude-dir=vendor,node_modules --json

TXT;
        return 0;
    },
    'version' => fn() => (print "scy v1.0.0\n") || 0,
];

if (!isset($commands[$command])) {
    $commands['help']();
    exit(0);
}

// remove command name before passing to command
array_shift($args);

$handler = $commands[$command];
exit(is_callable($handler) ? $handler() : $handler->execute($args));
